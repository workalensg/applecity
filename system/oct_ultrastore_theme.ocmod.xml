<?xml version="1.0" encoding="utf-8"?>
<modification>
	<code>oct_ultrastore_theme</code>
	<name>Octemplates - UltraStore Theme</name>
	<version>1.1.0</version>
	<author>Octemplates</author>
	<link>https://octemplates.net/</link>
	<file path="admin/controller/common/header.php">
		<operation>
			<search><![CDATA[$this->load->model('user/user');]]></search>
			<add position="before"><![CDATA[
			if ($this->config->get('theme_oct_ultrastore_alert_status')) {
				$data['oct_alert_status'] = $this->config->get('theme_oct_ultrastore_alert_status');

				$data['oct_alert_data'] = $oct_alert_data = $this->config->get('theme_oct_ultrastore_alert_data');
				$oct_total_calls = $oct_total_found_cheaper = $oct_total_reviews = $product_total = $review_total = $return_total = 0;

				if (isset($oct_alert_data['oct_modules']) && $oct_alert_data['oct_modules']) {
					if ($this->config->get('oct_popup_call_phone_status')) {
						$this->load->model('octemplates/module/oct_popup_call_phone');

						$filter_data = [
							'filter_processed' => 0
						];

						$data['oct_total_calls'] = $oct_total_calls = $this->model_octemplates_module_oct_popup_call_phone->getTotalCallArray($filter_data);
						$data['oct_popup_call_phone'] = $this->url->link('octemplates/module/oct_popup_call_phone', 'user_token=' . $this->session->data['user_token'], true);
					}

					if ($this->config->get('oct_popup_found_cheaper_status')) {
						$this->load->model('octemplates/module/oct_popup_found_cheaper');

						$filter_data = [
							'filter_processed' => 0
						];

						$data['oct_total_found_cheaper'] = $oct_total_found_cheaper = $this->model_octemplates_module_oct_popup_found_cheaper->getTotalCallArray($filter_data);
						$data['oct_popup_found_cheaper'] = $this->url->link('octemplates/module/oct_popup_found_cheaper', 'user_token=' . $this->session->data['user_token'], true);
					}

					if ($this->config->get('oct_sreview_setting_status')) {
						$this->load->model('octemplates/module/oct_sreview_reviews');

						$filter_data = [
							'filter_status' => 0
						];

						$data['oct_total_reviews'] = $oct_total_reviews = $this->model_octemplates_module_oct_sreview_reviews->getTotalReviews($filter_data);
						$data['oct_reviews'] = $this->url->link('octemplates/module/oct_sreview_reviews', 'user_token=' . $this->session->data['user_token'] . '&filter_status=0', true);
					}
				}

				if (isset($oct_alert_data['orders']) && $oct_alert_data['orders']) {
					// Orders
					$this->load->model('sale/order');

					// Processing Orders
					$data['processing_status_total'] = $this->model_sale_order->getTotalOrders(array('filter_order_status' => implode(',', $this->config->get('config_processing_status'))));
					$data['processing_status'] = $this->url->link('sale/order', 'user_token=' . $this->session->data['user_token'] . '&filter_order_status=' . implode(',', $this->config->get('config_processing_status')), true);

					// Complete Orders
					$data['complete_status_total'] = $this->model_sale_order->getTotalOrders(array('filter_order_status' => implode(',', $this->config->get('config_complete_status'))));
					$data['complete_status'] = $this->url->link('sale/order', 'user_token=' . $this->session->data['user_token'] . '&filter_order_status=' . implode(',', $this->config->get('config_complete_status')), true);

					// Returns
					$this->load->model('sale/return');

					$return_total = $this->model_sale_return->getTotalReturns(array('filter_return_status_id' => $this->config->get('config_return_status_id')));

					$data['return_total'] = $return_total;

					$data['return'] = $this->url->link('sale/return', 'user_token=' . $this->session->data['user_token'], true);
				}

				if (isset($oct_alert_data['products']) && $oct_alert_data['products']) {
					// Products
					$this->load->model('catalog/product');

					$product_total = $this->model_catalog_product->getTotalProducts(array('filter_quantity' => 0));

					$data['product_total'] = $product_total;

					$data['product'] = $this->url->link('catalog/product', 'user_token=' . $this->session->data['user_token'] . '&filter_quantity=0', true);

					// Reviews
					$this->load->model('catalog/review');

					$review_total = $this->model_catalog_review->getTotalReviews(array('filter_status' => 0));

					$data['review_total'] = $review_total;

					$data['review'] = $this->url->link('catalog/review', 'user_token=' . $this->session->data['user_token'] . '&filter_status=0', true);
				}

				$data['oct_alerts'] = $oct_total_calls + $oct_total_found_cheaper + $oct_total_reviews + $product_total + $review_total + $return_total;
			}
			]]></add>
		</operation>
	</file>
	<file path="admin/view/template/common/header.twig">
		<operation error="skip">
			<search><![CDATA[<link href="view/javascript/font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet" />]]></search>
			<add position="before"><![CDATA[
			<link href="view/stylesheet/fontawesome-free-5.6.1-web/css/all.css" type="text/css" rel="stylesheet" />
			]]></add>
    	</operation>
    	<operation>
			<search><![CDATA[<ul class="nav navbar-nav navbar-right">]]></search>
			<add position="after"><![CDATA[
			{% if oct_alert_status is defined and oct_alert_status %}
				{% if (oct_alert_data.orders is defined and oct_alert_data.orders) or (oct_alert_data.products is defined and oct_alert_data.products) or (oct_alert_data.oct_modules is defined and oct_alert_data.oct_modules) %}
				<li class="dropdown">
					<a class="dropdown-toggle" data-toggle="dropdown" style="padding:0 20px;">{% if oct_alerts > 0 %}<span class="label label-danger pull-left" style="position:absolute;top:10px;left:6px;">{{ oct_alerts }}</span>{% endif %} <i class="fa fa-bell fa-lg"></i></a>
				    <ul class="dropdown-menu dropdown-menu-right" style="padding: 6px 10px;">
				    	{% if (oct_alert_data.oct_modules is defined and oct_alert_data.oct_modules) and (oct_total_reviews is defined or oct_total_found_cheaper is defined or oct_total_calls is defined) %}
				    	<li class="dropdown-header">{{ text_oct_modules }}</li>
				    	{% if oct_popup_call_phone is defined and oct_popup_call_phone %}
				        <li><a href="{{ oct_popup_call_phone }}" style="padding: 5px 5px;"><span class="label label-warning pull-right">{{ oct_total_calls }}</span>{{ text_oct_calls }}</a></li>
				        {% endif %}
				        {% if oct_popup_found_cheaper is defined and oct_popup_found_cheaper %}
				        <li><a href="{{ oct_popup_found_cheaper }}" style="padding: 5px 5px;"><span class="label label-warning pull-right">{{ oct_total_found_cheaper }}</span>{{ text_oct_found_cheaper }}</a></li>
				        {% endif %}
				        {% if oct_reviews is defined and oct_reviews %}
				        <li><a href="{{ oct_reviews }}" style="padding: 5px 5px;"><span class="label label-warning pull-right">{{ oct_total_reviews }}</span>{{ text_oct_reviews }}</a></li>
				        <li class="divider"></li>
				        {% endif %}
				        {% endif %}
				        {% if oct_alert_data.orders is defined and oct_alert_data.orders %}
				        <li class="dropdown-header">{{ text_oct_order }}</li>
				        <li><a href="{{ processing_status }}" style="padding: 5px 5px;"><span class="label label-warning pull-right">{{ processing_status_total }}</span>{{ text_processing_status }}</a></li>
				        <li><a href="{{ complete_status }}" style="padding: 5px 5px;"><span class="label label-success pull-right">{{ complete_status_total }}</span>{{ text_complete_status }}</a></li>
				        <li><a href="{{ return }}" style="padding: 5px 5px;"><span class="label label-danger pull-right">{{ return_total }}</span>{{ text_return }}</a></li>
				        <li class="divider"></li>
				        {% endif %}
				        {% if oct_alert_data.products is defined and oct_alert_data.products %}
				        <li class="dropdown-header">{{ text_oct_product }}</li>
				        <li><a href="{{ product }}" style="padding: 5px 5px;"><span class="label label-danger pull-right">{{ product_total }}</span>{{ text_stock }}</a></li>
				        <li><a href="{{ review }}" style="padding: 5px 5px;"><span class="label label-danger pull-right">{{ review_total }}</span>{{ text_review }}</a></li>
				        {% endif %}
				    </ul>
				</li>
				{% endif %}
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="admin/controller/catalog/information.php">
		<operation error="skip">
			<search><![CDATA[protected function validateDelete() {]]></search>
			<add position="before"><![CDATA[
			public function octAutocomplete() {
				$json = array();

				if (isset($this->request->get['filter_name'])) {
					$this->load->model('catalog/information');

					$filter_data = array(
						'filter_name' => $this->request->get['filter_name'],
						'sort'        => 'id.title',
						'order'       => 'ASC',
						'start'       => 0,
						'limit'       => 5
					);

					$results = $this->model_catalog_information->getInformations($filter_data);

					foreach ($results as $result) {
						$json[] = array(
							'information_id' => $result['information_id'],
							'name'       	 => strip_tags(html_entity_decode($result['title'], ENT_QUOTES, 'UTF-8')),
							'href'		  	 => $this->model_catalog_information->getInformationSeoUrls((int)$result['information_id']),
							'description' 	 => $this->model_catalog_information->getInformationDescriptions((int)$result['information_id']),
						);
					}
				}

				$sort_order = array();

				foreach ($json as $key => $value) {
					$sort_order[$key] = $value['name'];
				}

				array_multisort($sort_order, SORT_ASC, $json);

				$this->response->addHeader('Content-Type: application/json');
				$this->response->setOutput(json_encode($json));
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/setting/setting.php">
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->post['config_logo'])) {]]></search>
			<add position="before"><![CDATA[
			$this->load->language('octemplates/theme/oct_ultrastore');

			$data['captcha_pages'][] = array(
				'text'  => $this->language->get('entry_captcha_popup_purchase'),
				'value' => 'oct_popup_purchase'
			);

			$data['captcha_pages'][] = array(
				'text'  => $this->language->get('entry_captcha_sreview_reviews'),
				'value' => 'oct_sreview_reviews'
			);
			]]></add>
    	</operation>
	</file>
	<file path="admin/controller/catalog/category.php">
		<operation error="skip">
			<search><![CDATA[$data['languages'] = $this->model_localisation_language->getLanguages();]]></search>
			<add position="after"><![CDATA[
			$oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if ((isset($oct_ultrastore_data['category_page_group_links']) && ($oct_ultrastore_data['category_page_group_links'] == 'on' || $oct_ultrastore_data['category_page_group_links'] == 1)) || $this->config->get("oct_megamenu_categories_page")) {
				$data['oct_cat_page'] = true;

				if (isset($this->request->post['oct_cat_pages'])) {
					$data['oct_cat_pages'] = $this->request->post['oct_cat_pages'];
				} elseif (isset($this->request->get['category_id'])) {
					$data['oct_cat_pages'] = $this->model_catalog_category->getOCTCatPages($this->request->get['category_id']);
				} else {
					$data['oct_cat_pages'] = [];
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/catalog/category.php">
		<operation error="skip">
			<search><![CDATA[if (isset($data['image'])) {]]></search>
			<add position="before"><![CDATA[
			$oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if ((isset($oct_ultrastore_data['category_page_group_links']) && ($oct_ultrastore_data['category_page_group_links'] == 'on' || $oct_ultrastore_data['category_page_group_links'] == 1)) || $this->config->get("oct_megamenu_categories_page")) {
				$this->db->query("UPDATE " . DB_PREFIX . "category SET page_group_links = '' WHERE category_id = '" . (int)$category_id . "'");

				if (isset($data['oct_cat_pages'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "category SET page_group_links = '" . $this->db->escape(serialize($data['oct_cat_pages'])) . "' WHERE category_id = '" . (int)$category_id . "'");
				}

				$this->cache->delete('octemplates');
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[public function getTotalCategories() {]]></search>
			<add position="before"><![CDATA[
			public function getOCTCatPages($category_id) {
				$query = $this->db->query("SELECT page_group_links FROM " . DB_PREFIX . "category WHERE category_id = '". (int) $category_id ."'");

				return unserialize($query->row['page_group_links']);
			}
			]]></add>
    	</operation>
	</file>
	<file path="admin/view/template/catalog/category_form.twig">
    	<operation error="skip">
			<search><![CDATA[<li><a href="#tab-design" data-toggle="tab">{{ tab_design }}</a></li>]]></search>
			<add position="after"><![CDATA[
			{% if oct_cat_page is defined and oct_cat_page %}
			<li><a href="#tab-pages" data-toggle="tab">{{ tab_oct_category_pages }}</a></li>
			{% endif %}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[<div class="tab-pane" id="tab-seo">]]></search>
			<add position="before"><![CDATA[
			{% if oct_cat_page is defined and oct_cat_page %}
			<div class="tab-pane" id="tab-pages">
            		<table class="table table-bordered table-hover" id="oct_cat_pages_table">
					<tbody class="group_in">
						{% set advantages_row = 0 %}
						{% set advantages_row_page = 0 %}
						{% for oct_cat_page in oct_cat_pages %}
						<tr id="advantage-row{{ advantages_row }}">
							<td>
								<table class="table table-bordered table-hover">
									<thead>
										<tr>
											<th>{{ text_oct_group_links }}</th>
											<th></th>
										</tr>
									</thead>
									<tr>
										<td class="text-right">
											{% for language in languages %}
											<div class="input-group">
						                        <span class="input-group-addon">
						                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
						                        </span>
												<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_group][{{ language.language_id }}]" value="{{ oct_cat_page.page_group[language.language_id] }}" id="advantage-title-{{ advantages_row }}{{ language.language_id }}" class="form-control" />
											</div>
											{% endfor %}
											<br />
											<table class="table table-bordered table-hover">
												<thead>
													<tr>
														<th>{{ text_oct_group_links_title }}</th>
														<th>{{ text_oct_group_links_link }}</th>
														<th></th>
													</tr>
												</thead>
												<tbody class="links_in{{ advantages_row }}">
													{% for oct_cat_page_link in oct_cat_page.page_links %}
													<tr id="advantage-page-row{{ advantages_row }}-{{ advantages_row_page }}">
														<td>
															{% for language in languages %}
															<div class="input-group">
										                        <span class="input-group-addon">
										                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
										                        </span>
																<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_links][{{ advantages_row_page }}][{{ language.language_id }}][title]" value="{{ oct_cat_page_link[language.language_id].title }}" id="advantage-linktitle-{{ advantages_row }}{{ advantages_row_page }}{{ language.language_id }}" class="form-control" />
															</div>
															{% endfor %}
														</td>
														<td>
															{% for language in languages %}
															<div class="input-group">
										                        <span class="input-group-addon">
										                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
										                        </span>
																<input type="text" name="oct_cat_pages[{{ advantages_row }}][page_links][{{ advantages_row_page }}][{{ language.language_id }}][link]" value="{{ oct_cat_page_link[language.language_id].link }}" id="advantage-link-{{ advantages_row }}{{ advantages_row_page }}{{ language.language_id }}" class="form-control" />
															</div>
															{% endfor %}
														</td>
														<td class="text-left" style="width:5%;">
															<button type="button" onclick="$('#advantage-page-row{{ advantages_row }}-{{ advantages_row_page }}').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
														</td>
													</tr>
													{% set advantages_row_page = advantages_row_page + 1 %}
													{% endfor %}
												</tbody>
												<tfoot>
													<tr>
														<td colspan="2"></td>
														<td class="text-left" style="width:5%;">
															<button type="button" onclick="addOCTCatLink({{ advantages_row }});" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
														</td>
													</tr>
												</tfoot>
											</table>
										</td>
										<td class="text-right" style="width:5%;">
											<button type="button" onclick="$('#advantage-row{{ advantages_row }}').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
										</td>
									</tr>
								</table>
							</td>
						</tr>
						{% set advantages_row = advantages_row + 1 %}
						{% endfor %}
					</tbody>
					<tfoot>
						<tr>
							<td class="text-right">
								<button type="button" onclick="addOCTCatGroup();" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
							</td>
						</tr>
					</tfoot>
				</table>
				<script>
				let advantages_row = {{ advantages_row }};

				function addOCTCatGroup() {
					const html = `
					<tr id="advantage-row${ advantages_row }">
						<td>
							<table class="table table-bordered table-hover">
								<thead>
									<tr>
										<th>{{ text_oct_group_links }}</th>
										<th></th>
									</tr>
								</thead>
								<tr>
									<td class="text-right">
										{% for language in languages %}
										<div class="input-group">
					                        <span class="input-group-addon">
					                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
					                        </span>
											<input type="text" name="oct_cat_pages[${ advantages_row }][page_group][{{ language.language_id }}]" value="" id="advantage-title-${ advantages_row }{{ language.language_id }}" class="form-control" />
										</div>
										{% endfor %}
										<br />
										<table class="table table-bordered table-hover">
											<thead>
												<tr>
													<th>{{ text_oct_group_links_title }}</th>
													<th>{{ text_oct_group_links_link }}</th>
													<th></th>
												</tr>
											</thead>
											<tbody class="links_in${ advantages_row }"></tbody>
											<tfoot>
												<tr>
													<td colspan="2"></td>
													<td class="text-left" style="width:5%;">
														<button type="button" onclick="addOCTCatLink(${ advantages_row });" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="add group"><i class="fa fa-plus-circle"></i></button>
													</td>
												</tr>
											</tfoot>
										</table>
									</td>
									<td class="text-right" style="width:5%;">
										<button type="button" onclick="$('#advantage-row${ advantages_row }').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					`;

					$('#oct_cat_pages_table tbody.group_in').append(html);

					advantages_row++;
				}

				let advantages_row_page = {{ advantages_row_page }};

				function addOCTCatLink(row) {
					const html = `
					<tr id="advantage-page-row${ row }-${ advantages_row_page }">
						<td>
							{% for language in languages %}
							<div class="input-group">
		                        <span class="input-group-addon">
		                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
		                        </span>
								<input type="text" name="oct_cat_pages[${ row }][page_links][${ advantages_row_page }][{{ language.language_id }}][title]" value="" id="advantage-linktitle-${ row }${ advantages_row_page }{{ language.language_id }}" class="form-control" />
							</div>
							{% endfor %}
						</td>
						<td>
							{% for language in languages %}
							<div class="input-group">
		                        <span class="input-group-addon">
		                        	<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
		                        </span>
								<input type="text" name="oct_cat_pages[${ row }][page_links][${ advantages_row_page }][{{ language.language_id }}][link]" value="" id="advantage-link-${ row }${ advantages_row_page }{{ language.language_id }}" class="form-control" />
							</div>
							{% endfor %}
						</td>
						<td class="text-left" style="width:5%;">
							<button type="button" onclick="$('#advantage-page-row${ row }-${ advantages_row_page }').remove()" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
						</td>
					</tr>
					`;

					$('#oct_cat_pages_table tbody.links_in'+row).append(html);

					advantages_row_page++;
				}
				</script>
            </div>
            {% endif %}
			]]></add>
    	</operation>
	</file>
	<file path="admin/model/localisation/language.php">
		<operation error="skip">
			<search><![CDATA[$language_data = $this->cache->get('language');]]></search>
			<add position="replace"><![CDATA[
			$language_data = $this->cache->get('admin.language');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/model/localisation/language.php">
		<operation error="skip">
			<search><![CDATA[$language_data = $this->cache->get('language');]]></search>
			<add position="replace"><![CDATA[
			$language_data = $this->cache->get('catalog.language');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/startup/startup.php">
		<operation error="skip">
			<search><![CDATA[Cart($this->registry));]]></search>
			<add position="after"><![CDATA[
			require_once DIR_SYSTEM. 'library/octemplates/Mobile_Detect.php';

			$this->registry->set('oct_mobiledetect', new OCTMobile_Detect());
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/checkout/success.php">
		<operation error="skip">
			<search><![CDATA[if (isset($this->session->data['order_id'])) {]]></search>
			<add position="after"><![CDATA[
			$oct_sucsess = $this->config->get('theme_oct_ultrastore_data_osucsess');

			if (isset($oct_sucsess['status'])) {
				$oct_order_id = $this->session->data['order_id'];
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['continue'] = $this->url->link('common/home');]]></search>
			<add position="before"><![CDATA[
			if ($this->customer->isLogged()) {
				if (isset($oct_order_id) && isset($oct_sucsess['status']) && isset($oct_sucsess['reg']['text'][(int)$this->config->get('config_language_id')])) {
					$oct_sucsess_title = isset($oct_sucsess['reg']['title'][(int)$this->config->get('config_language_id')]) ? $oct_sucsess['reg']['title'][(int)$this->config->get('config_language_id')] : '';

					$this->load->model('account/customer');
					$customer_info = $this->model_account_customer->getCustomer($this->customer->getId());

					$oct_user_data = isset($this->session->data['shipping_address']) ? $this->session->data['shipping_address'] : isset($this->session->data['payment_address']) ? $this->session->data['payment_address'] : [];

					$oct_replace = [
						'[order_id]' => (int)$oct_order_id,
						'[contact_link]' => $this->url->link('information/contact'),
						'[account_link]' => $this->url->link('account/account'),
						'[account_order_link]' => $this->url->link('account/order'),
						'[account_download_link]' => $this->url->link('account/download'),
						'[firstname]' => (isset($oct_user_data['firstname']) && !empty($oct_user_data['firstname'])) ? $oct_user_data['firstname'] : '',
						'[lastname]' => (isset($oct_user_data['lastname']) && !empty($oct_user_data['lastname'])) ? $oct_user_data['lastname'] : '',
						'[telephone]' => (isset($customer_info['telephone']) && !empty($customer_info['telephone'])) ? $customer_info['telephone'] : '',
						'[postcode]' => (isset($oct_user_data['postcode']) && !empty($oct_user_data['postcode'])) ? $oct_user_data['postcode'] : '',
						'[country]' => (isset($oct_user_data['country']) && !empty($oct_user_data['country'])) ? $oct_user_data['country'] : '',
						'[city]' => (isset($oct_user_data['city']) && !empty($oct_user_data['city'])) ? $oct_user_data['city'] : '',
						'[address]' => (isset($oct_user_data['address_1']) && !empty($oct_user_data['address_1'])) ? $oct_user_data['address_1'] : '',
					];

					$data['heading_title'] = (isset($oct_sucsess_title) && $oct_sucsess_title) ? strip_tags(html_entity_decode(str_replace(array_keys($oct_replace), array_values($oct_replace), $oct_sucsess_title), ENT_QUOTES, 'UTF-8')) : $this->language->get('heading_title');
					$data['text_message'] = html_entity_decode(str_replace(array_keys($oct_replace), array_values($oct_replace), $oct_sucsess['reg']['text'][(int)$this->config->get('config_language_id')]), ENT_QUOTES, 'UTF-8');
				}
			} else {
				if (isset($oct_order_id) && isset($oct_sucsess['status']) && isset($oct_sucsess['noreg']['text'][(int)$this->config->get('config_language_id')])) {
					$oct_sucsess_title = isset($oct_sucsess['noreg']['title'][(int)$this->config->get('config_language_id')]) ? $oct_sucsess['noreg']['title'][(int)$this->config->get('config_language_id')] : '';

					$oct_user_data = isset($this->session->data['shipping_address']) ? $this->session->data['shipping_address'] : isset($this->session->data['payment_address']) ? $this->session->data['payment_address'] : [];

					$oct_replace = [
						'[order_id]' => (int)$oct_order_id,
						'[contact_link]' => $this->url->link('information/contact'),
						'[firstname]' => (isset($oct_user_data['firstname']) && !empty($oct_user_data['firstname'])) ? $oct_user_data['firstname'] : '',
						'[lastname]' => (isset($oct_user_data['lastname']) && !empty($oct_user_data['lastname'])) ? $oct_user_data['lastname'] : '',
						'[telephone]' => (isset($this->session->data['guest']['telephone']) && !empty($this->session->data['guest']['telephone'])) ? $this->session->data['guest']['telephone'] : '',
						'[postcode]' => (isset($oct_user_data['postcode']) && !empty($oct_user_data['postcode'])) ? $oct_user_data['postcode'] : '',
						'[country]' => (isset($oct_user_data['country']) && !empty($oct_user_data['country'])) ? $oct_user_data['country'] : '',
						'[city]' => (isset($oct_user_data['city']) && !empty($oct_user_data['city'])) ? $oct_user_data['city'] : '',
						'[address]' => (isset($oct_user_data['address_1']) && !empty($oct_user_data['address_1'])) ? $oct_user_data['address_1'] : '',
					];

					$data['heading_title'] = (isset($oct_sucsess_title) && $oct_sucsess_title) ? strip_tags(html_entity_decode(str_replace(array_keys($oct_replace), array_values($oct_replace), $oct_sucsess_title), ENT_QUOTES, 'UTF-8')) : $this->language->get('heading_title');
					$data['text_message'] = html_entity_decode(str_replace(array_keys($oct_replace), array_values($oct_replace), $oct_sucsess['noreg']['text'][(int)$this->config->get('config_language_id')]), ENT_QUOTES, 'UTF-8');
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="system/library/response.php">
		<operation error="skip">
			<search><![CDATA[public function output() {]]></search>
			<add position="after"><![CDATA[
			if (!defined('HTTP_CATALOG')) $this->output = str_replace('index.php?route=common/home', '', $this->output);

			$oct_output = $this->output;

			preg_match_all("/<style>(.*?)<\/style>/is", $oct_output, $oct_css_code);

			if (isset($oct_css_code[1]) && !empty($oct_css_code[1])) {
				$oct_output = preg_replace("/<style>.*?<\/style>/is", '', $oct_output);

				$styles = "<style>";

				foreach ($oct_css_code[1] as $code) {
					$styles .= $code;
				}

				$styles .= "</style></head>";

				$oct_output = str_replace("</head>", $styles, $oct_output);
			}

			$this->output = $oct_output;
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/header.php">
    	<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="replace"><![CDATA[
			public function octBreadcrumbs($data) {
				$data['oct_ultrastore_data'] = $this->config->get('theme_oct_ultrastore_data');

				return $this->load->view('octemplates/module/oct_breadcrumbs', $data);
			}

			public function index() {
				$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

				$data['oct_lang_id'] = (int)$this->config->get('config_language_id');

				if (isset($data['oct_ultrastore_data']['contact_open'][(int)$this->config->get('config_language_id')])){
					$oct_contact_opens = explode(PHP_EOL, $data['oct_ultrastore_data']['contact_open'][(int)$this->config->get('config_language_id')]);

					foreach ($oct_contact_opens as $oct_contact_open) {
						if (!empty($oct_contact_open)) {
							$data['oct_contact_opens'][] = html_entity_decode($oct_contact_open, ENT_QUOTES, 'UTF-8');
						}
					}
				}

				$oct_contact_telephones = explode(PHP_EOL, $data['oct_ultrastore_data']['contact_telephone']);

				foreach ($oct_contact_telephones as $oct_contact_telephone) {
					if (!empty($oct_contact_telephone)) {
						$data['oct_contact_telephones'][] = html_entity_decode($oct_contact_telephone, ENT_QUOTES, 'UTF-8');
					}
				}

				if (isset($oct_ultrastore_data['contact_map']) && !empty($oct_ultrastore_data['contact_map'])) {
					$data['contact_map'] = html_entity_decode($oct_ultrastore_data['contact_map'], ENT_QUOTES, 'UTF-8');
				}

				if (isset($oct_ultrastore_data['contact_address'])) {
				    foreach ($oct_ultrastore_data['contact_address'] as $oct_lang_id => $oct_adress) {
				        $data['oct_ultrastore_data']['contact_address'][$oct_lang_id] = html_entity_decode($oct_adress, ENT_QUOTES, 'UTF-8');
				    }
				}

				if ((isset($this->request->get['route']) && $this->request->get['route'] == 'common/home') || $this->request->server['REQUEST_URI'] == '/') {
					$data['oct_home'] = true;
				}

				$this->load->model('catalog/information');

				$data['mobile_informations'] = [];

				if (isset($oct_ultrastore_data['mobile_links']) && !empty($oct_ultrastore_data['mobile_links'])) {
					foreach ($oct_ultrastore_data['mobile_links'] as $mobile_link) {
						$data['mobile_informations'][] = array(
							'title' => html_entity_decode($mobile_link[(int)$this->config->get('config_language_id')]['title'], ENT_QUOTES, 'UTF-8'),
							'href'  => $mobile_link[(int)$this->config->get('config_language_id')]['link']
						);
					}
				} else {
					foreach ($this->model_catalog_information->getInformations() as $result) {
						$data['mobile_informations'][] = array(
							'title' => $result['title'],
							'href'  => $this->url->link('information/information', 'information_id=' . $result['information_id'])
						);
					}
				}

				$data['header_informations'] = [];

				if (isset($oct_ultrastore_data['header_links']) && !empty($oct_ultrastore_data['header_links'])) {
					foreach ($oct_ultrastore_data['header_links'] as $header_link) {
						$data['header_informations'][] = array(
							'title' => html_entity_decode($header_link[(int)$this->config->get('config_language_id')]['title'], ENT_QUOTES, 'UTF-8'),
							'href'  => $header_link[(int)$this->config->get('config_language_id')]['link']
						);
					}
				}

				$data['oct_bar_data'] = $oct_bar_data = $this->config->get('theme_oct_ultrastore_bar_data');

				if (isset($oct_bar_data['status']) && $oct_bar_data['status']) {
					$data['bar_position'] = isset($oct_bar_data['position']) ? $oct_bar_data['position'] : 'left';

					if (isset($oct_bar_data['show_cart']) && $oct_bar_data['show_cart']) {
						$data['cart_total_bar'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
					}

					if (isset($oct_bar_data['show_wishlist']) && $oct_bar_data['show_wishlist']) {
						$data['wishlist_link'] = $this->url->link('account/wishlist','', true);
						if ($this->customer->isLogged()) {
							$this->load->model('account/wishlist');

							$data['wishlist_total'] = $this->model_account_wishlist->getTotalWishlist();
						} else {
							$data['wishlist_total'] = (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0);
						}
					}

					if (isset($oct_bar_data['show_compare']) && $oct_bar_data['show_compare']) {
						$data['compare_link'] = $this->url->link('product/compare','', true);
						$data['compare_total'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);
					}
				}

				//START
				if (isset($oct_ultrastore_data['mobile_menu']['time']) && $oct_ultrastore_data['mobile_menu']['time']) {
					$data['oct_contact_opens_mobile'] = (isset($data['oct_contact_opens']) && !empty($data['oct_contact_opens'])) ? $data['oct_contact_opens'] : [];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['phones']) && $oct_ultrastore_data['mobile_menu']['phones']) {
					$data['oct_contact_telephones_mobile'] = (isset($data['oct_contact_telephones']) && !empty($data['oct_contact_telephones'])) ? $data['oct_contact_telephones'] : [];
				}

				$data['socials_mobile'] = (isset($oct_ultrastore_data['socials']) && !empty($oct_ultrastore_data['socials'])) ? $oct_ultrastore_data['socials'] : false;

				if (isset($oct_ultrastore_data['mobile_menu']['address']) && $oct_ultrastore_data['mobile_menu']['address']) {
					$data['oct_ultrastore_data']['contact_address_mobile'] = (isset($data['oct_ultrastore_data']['contact_address']) && !empty($data['oct_ultrastore_data']['contact_address'])) ? $data['oct_ultrastore_data']['contact_address'] : [];

					if (isset($oct_ultrastore_data['contact_map']) && !empty($oct_ultrastore_data['contact_map'])) {
						$data['contact_map_mobile'] = $data['contact_map'];
					}
				}

				$data['oct_messengers_mobile'] = [];

				if (isset($oct_ultrastore_data['mobile_menu']['email']) && $oct_ultrastore_data['mobile_menu']['email']) {
					$data['oct_messengers_mobile']['email'] = $oct_ultrastore_data['contact_email'];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['telegram']) && $oct_ultrastore_data['mobile_menu']['telegram']) {
					$data['oct_messengers_mobile']['telegram'] = $oct_ultrastore_data['mobile_menu']['telegram'];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['viber']) && $oct_ultrastore_data['mobile_menu']['viber']) {
					$data['oct_messengers_mobile']['viber'] = $oct_ultrastore_data['mobile_menu']['viber'];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['skype']) && $oct_ultrastore_data['mobile_menu']['skype']) {
					$data['oct_messengers_mobile']['skype'] = $oct_ultrastore_data['mobile_menu']['skype'];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['whatsapp']) && $oct_ultrastore_data['mobile_menu']['whatsapp']) {
					$data['oct_messengers_mobile']['whatsapp'] = $oct_ultrastore_data['mobile_menu']['whatsapp'];
				}

				if (isset($oct_ultrastore_data['mobile_menu']['messenger']) && $oct_ultrastore_data['mobile_menu']['messenger']) {
					$data['oct_messengers_mobile']['messenger'] = $oct_ultrastore_data['mobile_menu']['messenger'];
				}
				//END

				$data['sidebar_position'] = (isset($oct_ultrastore_data['mobile_sidebar_position']) && !empty($oct_ultrastore_data['mobile_sidebar_position'])) ? $oct_ultrastore_data['mobile_sidebar_position'] : 'top';

				$data['cart_mobile'] = $this->load->controller('common/cart/mobile');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/footer.php">
    	<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			$data['oct_lang_id'] = (int)$this->config->get('config_language_id');

			$data['oct_jscode'] = html_entity_decode($this->config->get('theme_oct_ultrastore_js_code'), ENT_QUOTES, 'UTF-8');

			$this->load->model('tool/image');

			$data['oct_customer_paymets'] = [];

			if (isset($oct_ultrastore_data['payments']['customers']) && !empty($oct_ultrastore_data['payments']['customers'])) {
				foreach ($oct_ultrastore_data['payments']['customers'] as $oct_c_payment) {
					if ((isset($oct_c_payment['status']) && $oct_c_payment['status'] == 'on') && isset($oct_c_payment['image']) && !empty($oct_c_payment['image']) && file_exists(DIR_IMAGE.$oct_c_payment['image'])) {
						$data['oct_customer_paymets'][] = $this->model_tool_image->resize($oct_c_payment['image'], 52, 32);
					}
				}
			}

			if ($this->registry->has('oct_mobiledetect')) {
		        if (($this->oct_mobiledetect->isiOS() || $this->oct_mobiledetect->isiPad()) && ((isset($this->request->get['product_id']) && $this->request->get['product_id']) || ((isset($this->request->get['route']) && $this->request->get['route'] == 'common/home') || $this->request->server['REQUEST_URI'] == '/'))) {
		            $data['oct_isiOS'] = 1;
		        }
		    }

			$lazy_link = 'catalog/view/theme/oct_ultrastore/js/lozad.js';

			if ($this->registry->has('oct_mobiledetect')) {
		        if ($this->oct_mobiledetect->isMobile() && !$this->oct_mobiledetect->isTablet() && $this->config->get('theme_oct_ultrastore_lazyload_mobile')) {
		            $this->document->addScript($lazy_link, 'footer');
		        } elseif ($this->oct_mobiledetect->isTablet() && $this->config->get('theme_oct_ultrastore_lazyload_tablet')) {
                    $this->document->addScript($lazy_link, 'footer');
                } elseif ($this->config->get('theme_oct_ultrastore_lazyload_desktop')) {
                    $this->document->addScript($lazy_link, 'footer');
                }
		    } elseif ($this->config->get('theme_oct_ultrastore_lazyload_desktop')) {
                $this->document->addScript($lazy_link, 'footer');
            }
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[foreach ($this->model_catalog_information->getInformations() as $result) {]]></search>
			<add position="replace" offset="7"><![CDATA[
			if (isset($data['oct_ultrastore_data']['footer_links']) && !empty($data['oct_ultrastore_data']['footer_links'])) {
				foreach ($oct_ultrastore_data['footer_links'] as $footer_link) {
					$data['informations'][] = array(
						'title' => html_entity_decode($footer_link[(int)$this->config->get('config_language_id')]['title'], ENT_QUOTES, 'UTF-8'),
						'href'  => $footer_link[(int)$this->config->get('config_language_id')]['link']
					);
				}
			} else {
				foreach ($this->model_catalog_information->getInformations() as $result) {
					if ($result['bottom']) {
						$data['informations'][] = array(
							'title' => $result['title'],
							'href'  => $this->url->link('information/information', 'information_id=' . $result['information_id'])
						);
					}
				}
			}

			if (isset($data['oct_ultrastore_data']['footer_link_contact']) && $data['oct_ultrastore_data']['footer_link_contact'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_contact'),
					'href'  => $this->url->link('information/contact')
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_link_return']) && $data['oct_ultrastore_data']['footer_link_return'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_return'),
					'rel'	=> 1,
					'href'  => $this->url->link('account/return/add', '', true)
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_link_sitemap']) && $data['oct_ultrastore_data']['footer_link_sitemap'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_sitemap'),
					'href'  => $this->url->link('information/sitemap')
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_link_man']) && $data['oct_ultrastore_data']['footer_link_man'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_manufacturer'),
					'href'  => $this->url->link('product/manufacturer')
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_link_cert']) && $data['oct_ultrastore_data']['footer_link_cert'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_voucher'),
					'rel'	=> 1,
					'href'  => $this->url->link('account/voucher', '', true)
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_link_specials']) && $data['oct_ultrastore_data']['footer_link_specials'] == 'on') {
				$data['informations'][] = array(
					'title' => $this->language->get('text_special'),
					'href'  => $this->url->link('product/special')
				);
			}

			if (isset($data['oct_ultrastore_data']['footer_category_links']) && !empty($data['oct_ultrastore_data']['footer_category_links'])) {
				$this->load->model('catalog/category');

				foreach ($data['oct_ultrastore_data']['footer_category_links'] as $category_id) {
					$category_info = $this->model_catalog_category->getOCTCategory($category_id);

					if ($category_info) {
						$path = ($category_info['path']) ? $category_info['path'] . '_' . $category_info['category_id'] : $category_info['category_id'];

						$data['categories'][] = array(
							'name' => $category_info['name'],
							'href'  => $this->url->link('product/category', 'path=' . $path, true)
						);
					}
				}
			}

			if (isset($data['oct_ultrastore_data']['contact_open'][(int)$this->config->get('config_language_id')])){
				$oct_contact_opens = explode(PHP_EOL, $data['oct_ultrastore_data']['contact_open'][(int)$this->config->get('config_language_id')]);

				foreach ($oct_contact_opens as $oct_contact_open) {
					if (!empty($oct_contact_open)) {
						$data['oct_contact_opens'][] = html_entity_decode($oct_contact_open, ENT_QUOTES, 'UTF-8');
					}
				}
			}

			$oct_contact_telephones = explode(PHP_EOL, $data['oct_ultrastore_data']['contact_telephone']);

			foreach ($oct_contact_telephones as $oct_contact_telephone) {
				if (!empty($oct_contact_telephone)) {
					$data['oct_contact_telephones'][] = html_entity_decode($oct_contact_telephone, ENT_QUOTES, 'UTF-8');
				}
			}

			if (isset($oct_ultrastore_data['contact_address'])) {
				foreach ($oct_ultrastore_data['contact_address'] as $oct_lang_id => $oct_adress) {
					$data['oct_ultrastore_data']['contact_address'][$oct_lang_id] = html_entity_decode($oct_adress, ENT_QUOTES, 'UTF-8');
				}
			}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/oct_ultrastore/template/common/header.twig">
		<operation error="skip">
			<search><![CDATA[<body class="{{ sidebar_position }}">]]></search>
			<add position="after"><![CDATA[
			{% if oct_bar_data.status is defined and oct_bar_data.status  %}
			<div class="oct-fixed-bar fixed-{{ bar_position }}">
				{% if oct_bar_data.show_wishlist is defined and oct_bar_data.show_wishlist %}
				<div class="oct-fixed-bar-item oct-fixed-bar-wishlist">
					<a href="{{ wishlist_link }}" class="oct-fixed-bar-link" title="{{ fixed_bar_wishlist }}"><i class="fas fa-heart"></i><span class="oct-fixed-bar-quantity oct-wishlist-quantity">{{ wishlist_total }}</span></a>
				</div>
				{% endif %}
				{% if oct_bar_data.show_compare is defined and oct_bar_data.show_compare %}
				<div class="oct-fixed-bar-item oct-fixed-bar-compare">
					<a href="{{ compare_link }}" class="oct-fixed-bar-link" title="{{ fixed_bar_compare }}"><i class="fas fa-chart-bar"></i><span class="oct-fixed-bar-quantity oct-compare-quantity">{{ compare_total }}</span></a>
				</div>
				{% endif %}
				{% if oct_bar_data.show_cart is defined and oct_bar_data.show_cart %}
				<div class="oct-fixed-bar-item oct-fixed-bar-cart">
					{% if oct_popup_cart_status is defined and oct_popup_cart_status %}
					<a href="javascript:;" onclick="octPopupCart()" class="oct-fixed-bar-link" title="{{ fixed_bar_cart }}">
					{% else %}
					<a href="{{ shopping_cart }}" class="oct-fixed-bar-link" title="{{ fixed_bar_cart }}">
					{% endif %}
					<i class="fas fa-shopping-cart"></i><span id="oct-cart-quantity" class="oct-fixed-bar-quantity">{{ cart_total_bar }}</span></a>
				</div>
				{% endif %}
			</div>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/view/theme/oct_ultrastore/template/common/footer.twig">
		<operation error="skip">
			<search><![CDATA[<footer>]]></search>
			<add position="after"><![CDATA[
			{% if oct_ultrastore_data.footer_totop is defined and oct_ultrastore_data.footer_totop %}
			<div id="back-top">
		        <a href="#top"><i class="fas fa-chevron-up"></i></a>
		    </div>
			{% endif %}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[</body>]]></search>
			<add position="before"><![CDATA[
			{% if oct_jscode is defined and oct_jscode %}
			<script>
			{{ oct_jscode }}
			</script>
			{% endif %}
			]]></add>
		</operation>
	</file>
	<file path="catalog/controller/extension/module/account.php">
		<operation error="skip">
			<search><![CDATA[$data['recurring'] = $this->url->link('account/recurring', '', true);]]></search>
			<add position="after"><![CDATA[
			if ($this->customer->isLogged()) {
				$this->load->model('account/customer');

				$affiliate_info = $this->model_account_customer->getAffiliate($this->customer->getId());

				if (!$affiliate_info) {
					$data['affiliate'] = $this->url->link('account/affiliate/add', '', true);
					$data['tracking'] = '';
				} else {
					$data['affiliate'] = $this->url->link('account/affiliate/edit', '', true);
					$data['tracking'] = $this->url->link('account/tracking', '', true);
				}
			} else {
				$data['affiliate'] = $this->url->link('affiliate/login', '', true);
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/octemplates/module/oct_popup_view.php">
		<operation error="skip">
			<search><![CDATA[$oct_popup_view_data = $this->config->get('oct_popup_view_data');]]></search>
			<add position="before"><![CDATA[
			$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if (isset($oct_ultrastore_data['product_js_button']) && !empty($oct_ultrastore_data['product_js_button'])) {
				$data['product_js_button'] = html_entity_decode($oct_ultrastore_data['product_js_button'], ENT_QUOTES, 'UTF-8');
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/product.php">
    	<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if (isset($oct_ultrastore_data['product_js_button']) && !empty($oct_ultrastore_data['product_js_button'])) {
				$data['product_js_button'] = html_entity_decode($oct_ultrastore_data['product_js_button'], ENT_QUOTES, 'UTF-8');
			}

			if (isset($oct_ultrastore_data['product_dop_tab']) && !empty($oct_ultrastore_data['product_dop_tab'])) {
				$data['dop_tab'] = [
					'title' => isset($oct_ultrastore_data['product_dop_tab_title'][(int)$this->config->get('config_language_id')]) ? html_entity_decode($oct_ultrastore_data['product_dop_tab_title'][(int)$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8') : '',
					'text' => isset($oct_ultrastore_data['product_dop_tab_text'][(int)$this->config->get('config_language_id')]) ? html_entity_decode($oct_ultrastore_data['product_dop_tab_text'][(int)$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8') : '',
				];
			}

			if ((isset($oct_ultrastore_data['product_advantage']) && $oct_ultrastore_data['product_advantage'] == 'on') && (isset($oct_ultrastore_data['product_advantages']) && !empty($oct_ultrastore_data['product_advantages']))) {
				foreach ($oct_ultrastore_data['product_advantages'] as $product_advantage) {
					if (isset($product_advantage[(int)$this->config->get('config_language_id')]['title']) && !empty($product_advantage[(int)$this->config->get('config_language_id')]['title'])) {
						if (isset($product_advantage[(int)$this->config->get('config_language_id')]['link'])) {
							if ($product_advantage[(int)$this->config->get('config_language_id')]['link'] == "#" || empty($product_advantage[(int)$this->config->get('config_language_id')]['link'])) {
								$link = "javascript:;";
							} else {
								$link = $product_advantage[(int)$this->config->get('config_language_id')]['link'];
							}
						} else {
							$link = "javascript:;";
						}

						$data['oct_product_advantages'][] = [
							'information_id' => isset($product_advantage['information_id']) && !empty($product_advantage['information_id']) ? (int)$product_advantage['information_id'] : 0,
							'popup' => (isset($product_advantage['popup']) && !empty($product_advantage['popup'])) && (isset($product_advantage['information_id']) && !empty($product_advantage['information_id'])) && (isset($product_advantage['information_id']) && !empty($product_advantage['information_id'])) ? 1 : 0,
							'icone' => strip_tags(html_entity_decode($product_advantage['icone'], ENT_QUOTES, 'UTF-8')),
							'title' => strip_tags(html_entity_decode($product_advantage[(int)$this->config->get('config_language_id')]['title'], ENT_QUOTES, 'UTF-8')),
							'text' => isset($product_advantage[(int)$this->config->get('config_language_id')]['text']) ? strip_tags(html_entity_decode($product_advantage[(int)$this->config->get('config_language_id')]['text'], ENT_QUOTES, 'UTF-8')) : '',
							'link' => $link,
						];
					}
				}
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[if ($product_info['quantity'] <= 0) {]]></search>
			<add position="replace"><![CDATA[
			$data['out_of_stock'] = false;

			if (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning')) {
				$data['max_quantity'] = $product_info['quantity'];
			}

			if ($product_info['quantity'] <= 0) {
				$data['out_of_stock'] = true;
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');]]></search>
			<add position="replace" offset="5"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js');
			//$this->document->addStyle('catalog/view/javascript/jquery/magnific/magnific-popup.css');
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js');
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js');
			//$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js');
			//$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['attribute_groups'] = $this->model_catalog_product->getProductAttributes($this->request->get['product_id']);]]></search>
			<add position="before"><![CDATA[
			$oct_add_datetimepicker = false;

			foreach ($data['options'] as $option) {
				if ($option['type'] == 'date' || $option['type'] == 'time' || $option['type'] == 'datetime') {
					$data['oct_datetimepicker'] = $oct_add_datetimepicker = true;

					break;
				}
			}

			if ($oct_add_datetimepicker) {
				$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js');
				$this->document->addScript('catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js');
				$this->document->addScript('catalog/view/theme/oct_ultrastore/js/bootstrap-datetimepicker.min.js');
				$this->document->addStyle('catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css');
			}

			$this->document->addStyle('catalog/view/theme/oct_ultrastore/js/slick/slick.min.css');
			$this->document->addScript('catalog/view/theme/oct_ultrastore/js/slick/slick.min.js');

			$data['sku'] = $product_info['sku'];
			$data['upc'] = $product_info['upc'];
			$data['ean'] = $product_info['ean'];
			$data['mpn'] = $product_info['mpn'];
			$data['total_reviews'] = (int)$product_info['reviews'];

			if (!isset($oct_ultrastore_data['product_gallery'])) {
	            $this->document->addScript('catalog/view/theme/oct_ultrastore/js/fancybox/jquery.fancybox.min.js');
	            $this->document->addStyle('catalog/view/theme/oct_ultrastore/js/fancybox/jquery.fancybox.min.css');
        	}

			if (isset($oct_ultrastore_data['product_zoom']) && $oct_ultrastore_data['product_zoom']) {
	            $this->document->addScript('catalog/view/theme/oct_ultrastore/js/zoom/jquery.zoom.js');
        	}

        	$data['oct_reviews_list'] = (isset($data['review_status']) && $data['review_status']) ? $this->review() : '';
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$results = $this->model_catalog_product->getProductImages($this->request->get['product_id']);]]></search>
			<add position="after"><![CDATA[
			if ($data['popup'] && $data['thumb'] && !empty($results)) {
				$data['images'][0] = [
					'popup' => $data['popup'],
					'thumb_slider' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),
					'thumb' => $this->model_tool_image->resize($product_info['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_additional_height'))
				];
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['popup' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_popup_height')),]]></search>
			<add position="after"><![CDATA[
			'thumb_slider' => $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height')),
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$rating,]]></search>
			<add position="after"><![CDATA[
			'reviews'	  => $result['reviews'],
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['popup'] = '';]]></search>
			<add position="replace"><![CDATA[
			$data['popup'] = $this->model_tool_image->resize('no-thumb.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height'));
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['thumb'] = '';]]></search>
			<add position="replace"><![CDATA[
			$data['thumb'] = $this->model_tool_image->resize('no-thumb.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_thumb_height'));
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="replace"><![CDATA[
			$data['description'] = str_replace("<img", "<img class='img-fluid'", html_entity_decode($product_info['description'], ENT_QUOTES, 'UTF-8'));

			$oct_reg_youtube = '/<iframe[^<]+src="[^<]+www.youtube.com\/embed\/([-_a-z0-9]{11})[^<]+<\/iframe>/is';

			if (preg_match($oct_reg_youtube, $data['description'])) {
				$data['description'] = preg_replace_callback(
					$oct_reg_youtube,
					function ($description) {
						if (isset($description[1]) && !empty($description[1])) {
							$data['youtube_link'] = $description[1];

							return $this->load->view('octemplates/widgets/oct_youtube', $data);
						} else {
							return;
						}
					},
					$data['description']
				);

				$data['oct_is_youtube'] = true;
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[public function review() {]]></search>
			<add position="replace"><![CDATA[
			public function updatePrices() {
				if ((isset($this->request->post['product_id']) && isset($this->request->post['quantity'])) && isset($this->request->server['HTTP_X_REQUESTED_WITH']) && !empty($this->request->server['HTTP_X_REQUESTED_WITH']) && strtolower($this->request->server['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest') {
			        $json = [];

					if ($this->request->post['product_id'] && $this->request->post['quantity']) {
						$this->load->model('catalog/product');

						$json['special'] = false;
						$json['you_save'] = false;

						$option_price = 0;

						$product_id = (int)$this->request->post['product_id'];
						$quantity = (int)$this->request->post['quantity'];

						$product_info = $this->model_catalog_product->getOCTProductPrice($product_id, $quantity);
						$product_options = $this->model_catalog_product->getProductOptions($product_id);

						if (!empty($this->request->post['option'])) {
							$options = $this->request->post['option'];
						} else {
							$options = [];
						}

			            foreach ($product_options as $product_option) {
			              	if (is_array($product_option['product_option_value'])) {
			                	foreach ($product_option['product_option_value'] as $option_value) {
									if (isset($options[$product_option['product_option_id']])) {
										if (($options[$product_option['product_option_id']] == $option_value['product_option_value_id']) || ((is_array($options[$product_option['product_option_id']])) && (in_array($option_value['product_option_value_id'], $options[$product_option['product_option_id']])))) {
											if ($option_value['price_prefix'] == '+') {
												$option_price += $option_value['price'];
											} elseif ($option_value['price_prefix'] == '-') {
												$option_price -= $option_value['price'];
											}
										}
									}
								}
							}
			            }

						$price = (float)$product_info['discount'] ? (float)$product_info['discount'] * (int)$quantity + (float)$option_price * (int)$quantity : (float)$product_info['price'] * (int)$quantity + (float)$option_price * (int)$quantity;

						$special = (float)$product_info['special'] ? (float)$product_info['special'] * (int)$quantity + (float)$option_price * (int)$quantity : 0;

						if ($special) {
							$json['special'] = $this->currency->format($this->tax->calculate($special, $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);
							$json['you_save'] = '-' . number_format(((float)$price - (float)$special) / (float)$price * 100, 0) . '%';
						}

						$json['price'] = $this->currency->format($this->tax->calculate($price, $product_info['tax_class_id'], $this->config->get('config_tax')), $this->session->data['currency']);

						$json['tax'] = $this->currency->format((float)$special ? $special : $price, $this->session->data['currency']);
					}

					$this->response->addHeader('Content-Type: application/json');
					$this->response->setOutput(json_encode($json));
				} else {
					$this->response->redirect($this->url->link('error/not_found', '', true));
				}
			}

			public function review() {
				if (isset($this->request->post['product_id']) && !empty($this->request->post['product_id'])) {
					$this->request->get['product_id'] = $this->request->post['product_id'];
				}
			]]></add>
    	</operation>
    	<operation>
	    	<search><![CDATA['author'     => $result['author'],]]></search>
			<add position="after"><![CDATA[
			'reply'     => $result['reply'],
			]]></add>
    	</operation>
    	<operation>
	    	<search><![CDATA[$this->response->setOutput($this->load->view('product/review', $data));]]></search>
			<add position="replace"><![CDATA[
			if (isset($this->request->server['HTTP_X_REQUESTED_WITH']) && !empty($this->request->server['HTTP_X_REQUESTED_WITH']) && strtolower($this->request->server['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest') {
				if (isset($this->request->post['product_id']) && !empty($this->request->post['product_id'])) {
					return $this->load->view('product/review', $data);
				} else {
					$this->response->setOutput($this->load->view('product/review', $data));
				}
			} else {
				return $this->load->view('product/review', $data);
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/view/theme/oct_ultrastore/template/product/product.twig">
        <operation error="skip">
            <search><![CDATA[function updateProductPrice() {]]></search>
            <add position="before"><![CDATA[
			{% if oct_ultrastore_data.product_zoom is defined and oct_ultrastore_data.product_zoom %}
			$(document).ready(function() {
				$(".oct-gallery").zoom();
			});
			{% endif %}
	        {% if oct_ultrastore_data.product_gallery is not defined %}
			var sliderProducts = $('.us-product-slide a');

			$('.us-product-slide a').on('click', function(e) {
				e.preventDefault();

				var totalSlides = $(this).parents('.us-product-slide-box').slick("getSlick").slideCount,
				dataIndex = $(this).parents('.us-product-slide').data('slick-index'),
				trueIndex;

				switch(true) {
					case (dataIndex < 0):
						trueIndex = totalSlides+dataIndex;

						break;
					case (dataIndex >= totalSlides):
						trueIndex = dataIndex%totalSlides;

						break;
					default:
						trueIndex = dataIndex;
				}

				$.fancybox.open(sliderProducts, {backFocus: false, hideScrollbar: false}, trueIndex);

				return false;
			});
			{% endif %}
            ]]></add>
        </operation>
	</file>
	<file path="catalog/model/catalog/review.php">
        <operation error="skip">
            <search><![CDATA[, r.text]]></search>
            <add position="replace"><![CDATA[, r.text, r.reply]]></add>
        </operation>
	</file>
	<file path="admin/controller/catalog/review.php">
        <operation error="skip">
            <search><![CDATA[if (isset($this->request->post['rating'])) {]]></search>
            <add position="before"><![CDATA[
			if (isset($this->request->post['reply'])) {
				$data['reply'] = $this->request->post['reply'];
			} elseif (!empty($review_info)) {
				$data['reply'] = isset($review_info['reply']) ? $review_info['reply'] : '';
			} else {
				$data['reply'] = '';
			}
			]]></add>
        </operation>
	</file>
	<file path="admin/model/catalog/review.php">
        <operation error="skip">
            <search><![CDATA[, text = '" . $this->db->escape(strip_tags($data['text'])) . "']]></search>
            <add position="replace"><![CDATA[, text = '" . $this->db->escape(strip_tags($data['text'])) . "', reply = '" . $this->db->escape(strip_tags($data['reply'])) . "']]></add>
        </operation>
	</file>
	<file path="admin/view/template/catalog/review_form.twig">
        <operation error="skip">
            <search><![CDATA[<label class="col-sm-2 control-label" for="input-name">{{ entry_rating }}</label>]]></search>
            <add position="before" offset="1"><![CDATA[
			<div class="form-group">
	            <label class="col-sm-2 control-label" for="input-reply">{{ entry_reply }}</label>
	            <div class="col-sm-10">
	              <textarea name="reply" cols="60" rows="8" placeholder="{{ entry_reply }}" id="input-reply" class="form-control">{{ reply }}</textarea>
	            </div>
	          </div>
			]]></add>
        </operation>
	</file>
	<file path="catalog/controller/extension/module/category.php">
		<operation error="skip">
			<search><![CDATA[$children_data[] = array(]]></search>
			<add position="replace"><![CDATA[
			// Level 3
			$children_data_2 = [];
			$children_2 = $this->model_catalog_category->getCategories($child['category_id']);

			foreach ($children_2 as $child_2) {
				$filter_data2 = [
					'filter_category_id'  => $child_2['category_id'],
					'filter_sub_category' => true
				];

				/*
				$children_3 = $this->model_catalog_category->getCategories($child_2['category_id']);

				$children_data_3 = [];

				foreach ($children_3 as $child_3) {
					$filter_data3 = [
						'filter_category_id'  => $child_3['category_id'],
						'filter_sub_category' => true
					];

					$children_data_3[] = [
						'category_id' => $child_3['category_id'],
						'name'  => $child_3['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data3) . ')' : ''),
						'href'  => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id'] . '_' . $child_2['category_id'] . '_' . $child_3['category_id'])
					];
				}
				*/

				$children_data_2[] = [
					//'children' => $children_data_3,
					'category_id' => $child_2['category_id'],
					'name'  => $child_2['name'] . ($this->config->get('config_product_count') ? ' (' . $this->model_catalog_product->getTotalProducts($filter_data2) . ')' : ''),
					'href'  => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id'] . '_' . $child_2['category_id'])
				];
			}

			$children_data[] = array(
				'children' => $children_data_2,
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$this->load->model('catalog/category');]]></search>
			<add position="before"><![CDATA[
			if (isset($parts[2])) {
				$data['ch_id'] = $parts[2];
			} else {
				$data['ch_id'] = 0;
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[if ($category['category_id'] == $data['category_id']) {]]></search>
			<add position="replace"><![CDATA[
			$oct_full_view = true;

			if ($oct_full_view) {
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$categories = $this->model_catalog_category->getCategories(0);]]></search>
			<add position="before"><![CDATA[
			if(isset($this->request->server['HTTP_ACCEPT']) && strpos($this->request->server['HTTP_ACCEPT'], 'webp')) {
				$oct_webP = 1 . '-' . $this->session->data['currency'];
			} else {
				$oct_webP = 0 . '-' . $this->session->data['currency'];
			}

			$result_all_categories = $this->cache->get('octemplates.module_category.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . $oct_webP);

			if (!$result_all_categories) {
			]]></add>
		</operation>
		<operation error="skip">
			<search><![CDATA[$categories = $this->model_catalog_category->getCategories(0);]]></search>
			<add position="after"><![CDATA[
			$result_all_categories = [];
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[return $this->load->view('extension/module/category', $data);]]></search>
			<add position="before"><![CDATA[
				$result_all_categories = $data['categories'];

				$this->cache->set('octemplates.module_category.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . $oct_webP, $result_all_categories);
			}

			$data['categories'] = $result_all_categories;
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/{content_top,column_left,column_right,content_bottom}.php">
		<operation error="skip">
			<search><![CDATA[if ($setting_info && $setting_info['status']) {]]></search>
			<add position="replace"><![CDATA[
			if ($setting_info && isset($setting_info['status']) && $setting_info['status']) {
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/information/information.php">
		<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($information_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="after"><![CDATA[
			$data['description'] = str_replace("<img", "<img class='img-fluid'", $data['description']);

			$data['oct_is_youtube'] = false;

			$oct_reg_youtube = '/<iframe[^<]+src="[^<]+www.youtube.com\/embed\/([-_a-z0-9]{11})[^<]+<\/iframe>/is';

			if (preg_match($oct_reg_youtube, $data['description'])) {
				$data['description'] = preg_replace_callback(
					$oct_reg_youtube,
					function ($description) {
						if (isset($description[1]) && !empty($description[1])) {
							$data['youtube_link'] = $description[1];

							return $this->load->view('octemplates/widgets/oct_youtube', $data);
						} else {
							return;
						}
					},
					$data['description']
				);

				$data['oct_is_youtube'] = true;
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/cart.php">
		<operation error="skip">
			<search><![CDATA[$data['text_items'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="after"><![CDATA[
			$data['total_products'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
			$data['total_amount'] = $this->currency->format($total, $this->session->data['currency']);
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[public function info() {]]></search>
			<add position="before"><![CDATA[
			public function mobile() {
				$data['oct_popup_cart_status'] = $this->config->get('theme_oct_ultrastore_popup_cart_status');

				$data['cart_link'] = $this->url->link('checkout/cart');
				$data['checkout_link'] = $this->url->link('checkout/checkout', '', true);
				$data['wishlist_link'] = $this->url->link('account/wishlist', '', true);
				$data['compare_link'] = $this->url->link('product/compare', '', true);

				$data['total_products'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
				$data['total_compare'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);

				if ($this->customer->isLogged()) {
					$this->load->model('account/wishlist');

					$data['total_wishlist'] = $this->model_account_wishlist->getTotalWishlist();
				} else {
					$data['total_wishlist'] = (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0);
				}

				return $this->load->view('common/cart_mobile', $data);
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/compare.php">
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_compare'), (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0));]]></search>
			<add position="after"><![CDATA[
			$json['total_compare'] = (isset($this->session->data['compare']) ? count($this->session->data['compare']) : 0);
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/account/wishlist.php">
		<operation error="skip">
			<search><![CDATA[if (!$this->customer->isLogged()) {]]></search>
			<add position="replace"><![CDATA[
			if (!$this->customer->isLogged() && !$this->config->get('theme_oct_ultrastore_status')) {
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[if (isset($this->request->get['remove'])) {]]></search>
			<add position="after"><![CDATA[
			if ($this->customer->isLogged()) {
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->response->redirect($this->url->link('account/wishlist'));]]></search>
			<add position="after"><![CDATA[
			} else {
				if (isset($this->session->data['wishlist'])) {
					$oct_w_key = array_keys($this->session->data['wishlist'], $this->request->get['remove']);

					if (!empty($oct_w_key) && isset($oct_w_key[0])) {
						unset($this->session->data['wishlist'][$oct_w_key[0]]);

						$this->session->data['success'] = $this->language->get('text_remove');

						$this->response->redirect($this->url->link('account/wishlist'));
					}
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$results = $this->model_account_wishlist->getWishlist();]]></search>
			<add position="replace"><![CDATA[
			$results = $this->customer->isLogged() ? $this->model_account_wishlist->getWishlist() : ((isset($this->session->data['wishlist']) && !empty($this->session->data['wishlist'])) ? $this->session->data['wishlist'] : []);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$product_info = $this->model_catalog_product->getProduct($result['product_id']);]]></search>
			<add position="replace"><![CDATA[
			$product_info = $this->model_catalog_product->getProduct(isset($result['product_id']) ? $result['product_id'] : $result);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_wishlist'), (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0));]]></search>
			<add position="after"><![CDATA[
			$json['total_wishlist'] = (isset($this->session->data['wishlist']) ? count($this->session->data['wishlist']) : 0);
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_wishlist'), $this->model_account_wishlist->getTotalWishlist());]]></search>
			<add position="after"><![CDATA[
			$json['total_wishlist'] = $this->model_account_wishlist->getTotalWishlist();
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$json['success'] = sprintf($this->language->get('text_login'), $this->url->link('account/login', '', true), $this->url->link('account/register', '', true), $this->url->link('product/product', 'product_id=' . (int)$this->request->post['product_id']), $product_info['name'], $this->url->link('account/wishlist'));
]]></search>
			<add position="replace"><![CDATA[
			$json['success'] = sprintf($this->language->get('text_success'), $this->url->link('product/product', 'product_id=' . (int)$this->request->post['product_id']), $product_info['name'], $this->url->link('account/wishlist'));
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/account/account.php">
		<operation error="skip">
			<search><![CDATA[$this->load->model('account/customer');]]></search>
			<add position="after"><![CDATA[
			$customer_info = $this->model_account_customer->getCustomer($this->customer->getId());
			$data['email'] = $customer_info['email'];
			$data['firstname'] = $customer_info['firstname'];
			$data['url_contacts'] = $this->url->link('information/contact', '', true);

			$data['orders'] = [];
			$this->load->model('account/order');
			$order_total = $this->model_account_order->getTotalOrders();
			$page = 1;
			$results = $this->model_account_order->getOrders(($page - 1) * 10, 10);

			foreach ($results as $result) {
				$product_total = $this->model_account_order->getTotalOrderProductsByOrderId($result['order_id']);
				$voucher_total = $this->model_account_order->getTotalOrderVouchersByOrderId($result['order_id']);

				$data['orders'][] = [
					'order_id'   => $result['order_id'],
					'status'     => $result['status'],
					'date_added' => date($this->language->get('date_format_short'), strtotime($result['date_added'])),
					'total'      => $this->currency->format($result['total'], $result['currency_code'], $result['currency_value']),
					'href'       => $this->url->link('account/order/info', 'order_id=' . $result['order_id'], 'SSL'),
				];
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search><![CDATA[$json['total'] = sprintf($this->language->get('text_items'), $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0), $this->currency->format($total, $this->session->data['currency']));]]></search>
			<add position="after"><![CDATA[
			$json['isPopup'] = $this->config->get('theme_oct_ultrastore_popup_cart_ispopup') ? 1 : 0;
			$json['total_products'] = $this->cart->countProducts() + (isset($this->session->data['vouchers']) ? count($this->session->data['vouchers']) : 0);
			$json['total_amount'] = $this->currency->format($total, $this->session->data['currency']);
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->cart->add($this->request->post['product_id'], $quantity, $option, $recurring_id);]]></search>
			<add position="before" offset="1"><![CDATA[
			if ((!$product_info['quantity'] || ($product_info['quantity'] < $quantity)) && (!$this->config->get('config_stock_checkout') || $this->config->get('config_stock_warning'))) {
				if	($product_info['quantity'] < 1) {
					$json['error']['error_warning'] = $this->language->get('error_no_stock');
				} else {
					$json['error']['error_warning'] = sprintf($this->language->get('error_limited_stock'), $product_info['quantity']);
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search index="0"><![CDATA[$json['total_amount'] = $this->currency->format($total, $this->session->data['currency']);]]></search>
			<add position="after"><![CDATA[
			} elseif (isset($json['error']['error_warning']) && $json['error']['error_warning']) {
				$json['error']['error_warning'];]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/{category,manufacturer,search,special}.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if (isset($oct_ultrastore_data['category_view_sort_oder']) && $oct_ultrastore_data['category_view_sort_oder']) {
				$oct_ultrastore_sort_data = $this->config->get('theme_oct_ultrastore_sort_data');

				if (isset($oct_ultrastore_sort_data['deff_sort']) && $oct_ultrastore_sort_data['deff_sort']) {
					$sort_order = explode('-', $oct_ultrastore_sort_data['deff_sort']);
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$sort = 'p.sort_order';]]></search>
			<add position="replace"><![CDATA[
			$sort = (isset($sort_order) && !empty($sort_order) && isset($sort_order[0])) ? $sort_order[0] : 'p.sort_order';
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$order = 'ASC';]]></search>
			<add position="replace"><![CDATA[
			$order = (isset($sort_order) && !empty($sort_order) && isset($sort_order[1])) ? $sort_order[1] : 'ASC';
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['description' => utf8_substr(trim(strip_tags(html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8'))), 0, $this->config->get('theme_' . $this->config->get('config_theme') . '_product_description_length')) . '..',]]></search>
			<add position="replace"><![CDATA[
			'description' => (isset($oct_ultrastore_data['category_product_desc']) && $oct_ultrastore_data['category_product_desc'] == 'on') ? utf8_substr(trim(strip_tags(html_entity_decode($result['description'], ENT_QUOTES, 'UTF-8'))), 0, $this->config->get('theme_' . $this->config->get('config_theme') . '_product_description_length')) . '..' : false,
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$result['rating'],]]></search>
			<add position="replace"><![CDATA[
			$this->config->get('config_review_status') ? $result['rating'] : false,
			'oct_model'	  => $this->config->get('theme_oct_ultrastore_data_model') ? $result['model'] : '',
			'reviews'	  => $result['reviews'],
			'quantity'	  => $result['quantity'] <= 0 ? true : false,
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/category.php">
		<operation error="skip">
			<search><![CDATA[foreach ($results as $result) {]]></search>
			<add position="after"><![CDATA[
			if ($result['image'] && file_exists(DIR_IMAGE.$result['image'])) {
				$cat_image = $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_height'));
			} else {
				$cat_image = $this->model_tool_image->resize('placeholder.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_sub_category_height'));
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '_' . $result['category_id'] . $url)]]></search>
			<add position="before"><![CDATA[
			'image' => $cat_image,
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[if ($category_info['image']) {]]></search>
			<add position="replace"><![CDATA[
			if ($category_info['image'] && (isset($oct_ultrastore_data['category_cat_image']) && $oct_ultrastore_data['category_cat_image'])) {
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['description'] = html_entity_decode($category_info['description'], ENT_QUOTES, 'UTF-8');]]></search>
			<add position="after"><![CDATA[
			if (!isset($oct_ultrastore_data['category_desc_in_page']) && $page > 1) {
				$data['description'] = false;
				$data['thumb'] = false;
			} else {
				$data['description'] = str_replace("<img", "<img class='img-fluid'", html_entity_decode($category_info['description'], ENT_QUOTES, 'UTF-8'));
			}

			$data['language_id'] = (int)$this->config->get('config_language_id');
			$data['categories_page'] = (isset($oct_ultrastore_data['category_page_group_links']) && ($oct_ultrastore_data['category_page_group_links'] == 'on' || $oct_ultrastore_data['category_page_group_links'])) ? unserialize($category_info['page_group_links']) : [];
			]]></add>
    	</operation>
    	<operation error="skip">
			<search index="0"><![CDATA[$data['categories'] = array();]]></search>
			<add position="after"><![CDATA[
			if(isset($oct_ultrastore_data['category_view_subcats']) && $oct_ultrastore_data['category_view_subcats'] == 'on'){
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA[$data['products'] = array();]]></search>
			<add position="before"><![CDATA[
			}
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['filter_filter'      => $filter,]]></search>
			<add position="before"><![CDATA[
			'filter_sub_category' => (isset($oct_ultrastore_data['category_subcat_products']) && $oct_ultrastore_data['category_subcat_products'] == 'on') ? true : false,
			]]></add>
		</operation>
    	<operation error="skip">
			<search><![CDATA[$results = $this->model_catalog_category->getCategories($category_id);]]></search>
			<add position="before"><![CDATA[
			if(isset($this->request->server['HTTP_ACCEPT']) && strpos($this->request->server['HTTP_ACCEPT'], 'webp')) {
				$oct_webP = 1 . '-' . $this->session->data['currency'];
			} else {
				$oct_webP = 0 . '-' . $this->session->data['currency'];
			}

			$oct_categories = $this->cache->get('octemplates.sub_categories.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . (int)$category_id . '.' . $oct_webP);

			if (!$oct_categories) {
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '_' . $result['category_id'] . $url)]]></search>
			<add position="after" offset="2"><![CDATA[
				$oct_categories = $data['categories'];

				$this->cache->set('octemplates.sub_categories.' . (int)$this->config->get('config_language_id') . '.' . (int)$this->config->get('config_store_id') . '.' . $this->config->get('config_customer_group_id') . '.' . (int)$category_id . '.' . $oct_webP, $oct_categories);
			}

			$data['categories'] = $oct_categories;
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_ultrastore_sort_data) && !empty($oct_ultrastore_sort_data)) && (isset($oct_ultrastore_sort_data['sort']) && !empty($oct_ultrastore_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_ultrastore_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/category', 'path=' . $this->request->get['path'] . '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/view/theme/oct_ultrastore/template/product/category.twig">
    	<operation error="skip">
			<search><![CDATA[<div class="us-category-description-text">{{ description }}</div>]]></search>
			<add position="after"><![CDATA[
			{% if categories_page is defined and categories_page is not empty %}
			<div class="us-category-categories_page-text">
				<ul class="category-landing-links list-unstyled">
				{% for oct_page in categories_page %}
					{% if oct_page.page_links is not empty %}
					<li class="category-landing-links-item">
						<span class="category-landing-links-item-title">{{ oct_page.page_group[language_id] }}</span>
						{% for link in oct_page.page_links %}
						<a href="{{ link[language_id].link }}" class="category-landing-links-item-link d-flex-inline align-items-center" title="{{ link[language_id].title }}"><span>{{ link[language_id].title }}</span></a>
						{% endfor %}
					</li>
					{% endif %}
				{% endfor %}
				</ul>
			</div>
			{% endif %}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/search.php">
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/search', 'sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_ultrastore_sort_data) && !empty($oct_ultrastore_sort_data)) && (isset($oct_ultrastore_sort_data['sort']) && !empty($oct_ultrastore_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_ultrastore_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/search', '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/special.php">
		<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/special', 'sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_ultrastore_sort_data) && !empty($oct_ultrastore_sort_data)) && (isset($oct_ultrastore_sort_data['sort']) && !empty($oct_ultrastore_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_ultrastore_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/special', '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/product/manufacturer.php">
		<operation error="skip">
			<search><![CDATA[public function info() {]]></search>
			<add position="after"><![CDATA[
			$data['oct_ultrastore_data'] = $oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if (isset($oct_ultrastore_data['category_view_sort_oder']) && $oct_ultrastore_data['category_view_sort_oder']) {
				$oct_ultrastore_sort_data = $this->config->get('theme_oct_ultrastore_sort_data');

				if (isset($oct_ultrastore_sort_data['deff_sort']) && $oct_ultrastore_sort_data['deff_sort']) {
					$sort_order = explode('-', $oct_ultrastore_sort_data['deff_sort']);
				}
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['categories'][$key]['manufacturer'][] = array(]]></search>
			<add position="before"><![CDATA[
			if (isset($oct_ultrastore_data['man_logo']) && $oct_ultrastore_data['man_logo'] == 'on') {
				if ($result['image'] && is_file(DIR_IMAGE . $result['image'])) {
					$image = $this->model_tool_image->resize($result['image'], $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_height'));
				} else {
					$image = $this->model_tool_image->resize('placeholder.png', $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_width'), $this->config->get('theme_' . $this->config->get('config_theme') . '_image_manufacturer_height'));
				}
			} else {
				$image = false;
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA['href' => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $result['manufacturer_id'])]]></search>
			<add position="before"><![CDATA[
			'image' => $image,
			]]></add>
    	</operation>
    	<operation error="skip">
			<search><![CDATA['href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=p.model&order=DESC' . $url)]]></search>
			<add position="after" offset="1"><![CDATA[
			if ((isset($oct_ultrastore_sort_data) && !empty($oct_ultrastore_sort_data)) && (isset($oct_ultrastore_sort_data['sort']) && !empty($oct_ultrastore_sort_data['sort']))) {
				$data['sorts'] = [];

				foreach ($oct_ultrastore_sort_data['sort'] as $oct_sort) {
					$sort_order = explode('-', $oct_sort);

					$sort_name = str_replace(['.','-'], ['_', '_'], $oct_sort);

					if (!$this->config->get('config_review_status') && $sort_order[0] == 'rating') {
						continue;
					}

					$data['sorts'][] = array(
						'text'  => $this->language->get('text_' . $sort_name),
						'value' => $oct_sort,
						'href'  => $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] . '&sort=' . $sort_order[0] . '&order='. $sort_order[1] . $url)
					);
				}
			}
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/extension/module/{slideshow,carousel}.php">
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/swiper.min.css');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/opencart.css');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addStyle('catalog/view/javascript/jquery/swiper/css/opencart.css');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$this->document->addScript('catalog/view/javascript/jquery/swiper/js/swiper.jquery.js');]]></search>
			<add position="replace"><![CDATA[
			//$this->document->addScript('catalog/view/javascript/jquery/swiper/js/swiper.jquery.js');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['banners'] = array();]]></search>
			<add position="before"><![CDATA[
			$this->document->addStyle('catalog/view/theme/oct_ultrastore/js/slick/slick.min.css');
			$this->document->addScript('catalog/view/theme/oct_ultrastore/js/slick/slick.min.js');
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/information/contact.php">
		<operation error="skip">
			<search><![CDATA[public function index() {]]></search>
			<add position="after"><![CDATA[
			$oct_ultrastore_data = $this->config->get('theme_oct_ultrastore_data');

			if ((isset($oct_ultrastore_data['contact_view_map']) && $oct_ultrastore_data['contact_view_map'] == 'on') && (isset($oct_ultrastore_data['contact_map']) && !empty($oct_ultrastore_data['contact_map']))) {
				$data['contact_map'] = html_entity_decode($oct_ultrastore_data['contact_map'], ENT_QUOTES, 'UTF-8');
			}

			if (isset($oct_ultrastore_data['contact_view_html'][(int)$this->config->get('config_language_id')]) && !empty(strip_tags($oct_ultrastore_data['contact_view_html'][(int)$this->config->get('config_language_id')]))) {
				$data['contact_html'] = html_entity_decode($oct_ultrastore_data['contact_view_html'][(int)$this->config->get('config_language_id')], ENT_QUOTES, 'UTF-8');
			}

			if ($this->config->get('config_account_id')) {
	            $this->load->model('catalog/information');

	            $information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

	            if ($information_info) {
	                $data['text_terms'] = sprintf($this->language->get('text_oct_terms'), $this->url->link('information/information', 'information_id=' . $this->config->get('config_account_id'), 'SSL'), $information_info['title'], $information_info['title']);
	            } else {
	                $data['text_terms'] = '';
	            }
	        } else {
	            $data['text_terms'] = '';
	        }
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['button_submit'] = $this->language->get('button_submit');]]></search>
			<add position="before"><![CDATA[
			if (isset($this->error['scales'])) {
				$data['error_oct_terms'] = $this->error['scales'];
			} else {
				$data['error_oct_terms'] = '';
			}
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[return !$this->error;]]></search>
			<add position="before"><![CDATA[
	        if ($this->config->get('config_account_id') && !isset($this->request->post['scales'])) {
	            $this->load->model('catalog/information');

	            $information_info = $this->model_catalog_information->getInformation($this->config->get('config_account_id'));

	            $this->error['scales'] = sprintf($this->language->get('error_oct_terms'), $information_info['title']);
	        }
			]]></add>
    	</operation>
	</file>
	<file path="catalog/controller/common/maintenance.php">
		<operation error="skip">
			<search><![CDATA[$data['message'] = $this->language->get('text_message');]]></search>
			<add position="before"><![CDATA[
			$data['title'] = $this->language->get('text_maintenance');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['header'] = $this->load->controller('common/header');]]></search>
			<add position="replace"><![CDATA[
			//$data['header'] = $this->load->controller('common/header');
			]]></add>
    	</operation>
		<operation error="skip">
			<search><![CDATA[$data['footer'] = $this->load->controller('common/footer');]]></search>
			<add position="replace"><![CDATA[
			//$data['footer'] = $this->load->controller('common/footer');
			]]></add>
    	</operation>
	</file>
</modification>
